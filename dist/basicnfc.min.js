!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.TappyBasicNfcFamily=e()}(this,function(){var t=new Uint8Array([0,1]),e=function(t){var e=Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""),o=e.replace(/(.)/g,function(t,e){var o=e.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o});return decodeURIComponent(o)},o=function(t){var e=encodeURIComponent(t),o=e.replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)}),n=new Uint8Array(o.length);return Array.prototype.forEach.call(o,function(t,e){n[e]=t.charCodeAt(0)}),n},n=function(t,e){for(var o=[],n=0;n<e.length;n++){var r=e[n];"function"!=typeof t[r]&&o.push(r)}return o},r=function(t,e){var o=n(t,e);return!(null===o||o.length>0)},i=function(t,e){return t.length==e.length&&t.every(function(t,o){return t===e[o]})},a=["getCommandFamily","getCommandCode","getPayload"],s={},u={WriteNdefUri:5,WriteNdefText:6,WriteNdefCustom:7,EmulateNdefText:9,EmulateNdefUri:10,EmulateNdefCustom:11,StreamTags:1,StreamNdef:3,Stop:0,ScanTag:2,ScanNdef:4,LockTag:8,GetLibraryVersion:255},p={TYPE1:1,GENERAL:2},d=function(e){return function(o){if("object"!=typeof o||null===o)throw new Error("Command passed to check type must be an object implementing: "+a.join(", "));if(r(o,a))return i(o.getCommandFamily(),t)&&o.getCommandCode()===e;throw new Error("Command passed to check type must also implement: "+n(o,a).join(", "))}},y=function(e){return{getCommandFamily:function(){return t},getCommandCode:function(){return e},getPayload:function(){return[]},parsePayload:function(){}}},h=function(t){var e=y(t);return e.getPayload=function(){return new Uint8Array([this.timeout,this.pollingMode])},e.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: Basic NFC polling command payload must be at least two bytes");this.timeout=t[0],this.pollingMode=t[1]},e.getTimeout=function(){return this.timeout},e.setTimeout=function(t){this.timeout=t},e.getPollingMode=function(){return this.pollingMode},e.setPollingMode=function(t){this.pollingMode=t},e},l=function(){return function(t,e){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.pollingMode=p.GENERAL:this.pollingMode=e}},f=function(){};f.prototype=y(u.GetLibraryVersion),f.isTypeOf=d(u.GetLibraryVersion),s.GetLibraryVersion=f;var c=l();c.prototype=h(u.ScanNdef),c.isTypeOf=d(u.ScanNdef),s.ScanNdef=c;var g=l();g.prototype=h(u.StreamNdef),g.isTypeOf=d(u.StreamNdef),s.StreamNdef=g;var m=l();m.prototype=h(u.ScanTag),m.isTypeOf=d(u.ScanTag),s.ScanTag=m;var T=l();T.prototype=h(u.StreamTags),T.isTypeOf=d(u.StreamTags),s.StreamTags=T;var C=function(t,e){"number"==typeof t?this.timeout=t:this.timeout=0,"undefined"!=typeof e&&null!==e?this.uid=e:this.uid=new Uint8Array(0)};C.prototype=y(u.LockTag),C.isTypeOf=d(u.LockTag),C.prototype.getPayload=function(){var t=this.uid.length,e=new Uint8Array(2+t);return e[0]=this.timeout,e[1]=t,t>0&&e.set(this.uid,2),e},C.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: Lock tag command payload must be at least two bytes");this.timeout=t[0];var e=t[1];if(e>0){if(!(e+2<=t.length))throw new Error("Invalid payload: lock tag payload too short to contain UID length claimed");this.uid=t.subarray(2,2+e)}else this.uid=new Uint8Array(0)},C.prototype.getTimeout=function(){return this.timeout},C.prototype.setTimeout=function(t){this.timeout=t},C.prototype.getTagCode=function(){return this.uid},C.prototype.setTagCode=function(t){this.uid=t},s.LockTag=C;var E=function(){};E.prototype=y(u.Stop),E.isTypeOf=d(u.Stop),s.Stop=E;var w=function(t,e,o){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.locks=!1:this.locks=e,"undefined"==typeof o?this.text="":this.text=o};w.prototype=y(u.WriteNdefText),w.isTypeOf=d(u.WriteNdefText),w.prototype.getPayload=function(){var t=o(this.text),e=new Uint8Array(t.length+2);return e[0]=this.timeout,e[1]=this.locks?1:0,e.set(t,2),e},w.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: write ndef text must be at least 2 bytes long");if(this.timeout=t[0],this.locks=1===t[1],t.length>2){var o=t.slice(2);this.text=e(o)}else this.text=""},w.prototype.getTimeout=function(){return this.timeout},w.prototype.setTimeout=function(t){this.timeout=t},w.prototype.getLockFlag=function(){return this.locks},w.prototype.setLockFlag=function(t){this.locks=t},w.prototype.getText=function(){return this.text},w.prototype.setText=function(t){this.text=t},s.WriteNdefText=w;var S=function(t,e,o,n){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.locks=!1:this.locks=e,"undefined"==typeof o?this.uri="":this.uri=o,"undefined"==typeof n?this.uriCode=0:this.uriCode=n};S.prototype=y(u.WriteNdefUri),S.isTypeOf=d(u.WriteNdefUri),S.prototype.getPayload=function(){var t=o(this.uri),e=new Uint8Array(t.length+3);return e[0]=this.timeout,e[1]=this.locks?1:0,e[2]=this.uriCode,e.set(t,3),e},S.prototype.parsePayload=function(t){if(t.length<3)throw new Error("Invalid payload: write ndef uri must be at least 2 bytes long");if(this.timeout=t[0],this.locks=1===t[1],this.uriCode=t[2],t.length>3){var o=t.slice(3);this.uri=e(o)}else this.uri=""},S.prototype.getTimeout=function(){return this.timeout},S.prototype.setTimeout=function(t){this.timeout=t},S.prototype.getLockFlag=function(){return this.locks},S.prototype.setLockFlag=function(t){this.locks=t},S.prototype.getUri=function(){return this.uri},S.prototype.setUri=function(t){this.uri=t},S.prototype.getUriCode=function(){return this.uriCode},S.prototype.setUriCode=function(t){this.uriCode=t},s.WriteNdefUri=S;var b=function(t,e,o){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.locks=!1:this.locks=e,"undefined"==typeof o?this.msg=new Uint8Array(0):this.msg=o};b.prototype=y(u.WriteNdefCustom),b.isTypeOf=d(u.WriteNdefCustom),b.prototype.getPayload=function(){var t=new Uint8Array(this.msg.length+2);return t[0]=this.timeout,t[1]=this.locks?1:0,t.set(this.msg,2),t},b.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: write ndef uri must be at least 2 bytes long");this.timeout=t[0],this.locks=1===t[1],t.length>2?this.msg=t.slice(2):this.msg=new Uint8Array(0)},b.prototype.getTimeout=function(){return this.timeout},b.prototype.setTimeout=function(t){this.timeout=t},b.prototype.getLockFlag=function(){return this.locks},b.prototype.setLockFlag=function(t){this.locks=t},b.prototype.getMessage=function(){return this.msg},b.prototype.setMessage=function(t){this.msg=t},s.WriteNdefCustom=b;var v=function(t,e,o){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.maxScans=0:this.maxScans=e,"undefined"==typeof o?this.text="":this.text=o};v.prototype=y(u.EmulateNdefText),v.isTypeOf=d(u.EmulateNdefText),v.prototype.getPayload=function(){var t=o(this.text),e=new Uint8Array(t.length+2);return e[0]=this.timeout,e[1]=this.maxScans,e.set(t,2),e},v.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: emulate ndef text must be at least 2 bytes long");if(this.timeout=t[0],this.maxScans=t[1],t.length>2){var o=t.slice(2);this.text=e(o)}else this.text=""},v.prototype.getTimeout=function(){return this.timeout},v.prototype.setTimeout=function(t){this.timeout=t},v.prototype.getMaxScans=function(){return this.maxScans},v.prototype.setMaxScans=function(t){this.maxScans=t},v.prototype.getText=function(){return this.text},v.prototype.setText=function(t){this.text=t},s.EmulateNdefText=v;var N=function(t,e,o,n){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.maxScans=0:this.maxScans=e,"undefined"==typeof o?this.uri="":this.uri=o,"undefined"==typeof n?this.uriCode=0:this.uriCode=n};N.prototype=y(u.EmulateNdefUri),N.isTypeOf=d(u.EmulateNdefUri),N.prototype.getPayload=function(){var t=o(this.uri),e=new Uint8Array(t.length+3);return e[0]=this.timeout,e[1]=this.maxScans,e[2]=this.uriCode,e.set(t,3),e},N.prototype.parsePayload=function(t){if(t.length<3)throw new Error("Invalid payload: eumulate ndef uri must be at least 3 bytes long");if(this.timeout=t[0],this.maxScans=t[1],this.uriCode=t[2],t.length>3){var o=t.slice(3);this.uri=e(o)}else this.uri=""},N.prototype.getTimeout=function(){return this.timeout},N.prototype.setTimeout=function(t){this.timeout=t},N.prototype.getMaxScans=function(){return this.maxScans},N.prototype.setMaxScans=function(t){this.maxScans=t},N.prototype.getUriCode=function(){return this.uriCode},N.prototype.setUriCode=function(t){this.uriCode=t},N.prototype.getUri=function(){return this.uri},N.prototype.setUri=function(t){this.uri=t},s.EmulateNdefUri=N;var P=function(t,e,o){"undefined"==typeof t?this.timeout=0:this.timeout=t,"undefined"==typeof e?this.maxScans=0:this.maxScans=e,"undefined"==typeof o?this.msg=new Uint8Array(0):this.msg=o};P.prototype=y(u.EmulateNdefCustom),P.isTypeOf=d(u.EmulateNdefCustom),P.prototype.getPayload=function(){var t=new Uint8Array(2+this.msg.length);return t[0]=this.timeout,t[1]=this.maxScans,t.set(this.msg,2),t},P.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: emulate ndef custom must be at least 2 bytes long");this.timeout=t[0],this.maxScans=t[1],t.length>2?this.msg=t.slice(2):this.msg=new Uint8Array(0)},P.prototype.getTimeout=function(){return this.timeout},P.prototype.setTimeout=function(t){this.timeout=t},P.prototype.getMaxScans=function(){return this.maxScans},P.prototype.setMaxScans=function(t){this.maxScans=t},P.prototype.getMessage=function(){return this.msg},P.prototype.setMessage=function(t){this.msg=t},s.EmulateNdefCustom=P;var A={},k={LibraryVersion:4,TagWritten:5,TagFound:1,ScanTimeout:3,NdefFound:2,TagLocked:6,ApplicationError:127,EmulationScanSuccess:7,EmulationComplete:8},x=function(t,e){"undefined"!=typeof t?this.tagCode=t:this.tagCode=new Uint8Array(4),"undefined"!=typeof e?this.tagType=e:this.tagType=0};x.prototype=y(k.TagWritten),x.isTypeOf=d(k.TagWritten),x.prototype.getPayload=function(){var t=new Uint8Array(this.tagCode.length+1);return t[0]=this.tagType,this.tagCode.length>0&&t.set(this.tagCode,1),t},x.prototype.parsePayload=function(t){if(t.length<1)throw new Error("Invalid Payload: tag written response must be longer than one byte");this.tagType=t[0],t.length>1?this.tagCode=t.slice(1):this.tagCode=new Uint8Array(0)},x.prototype.getTagType=function(){return this.tagType},x.prototype.setTagType=function(t){this.tagType=t},x.prototype.getTagCode=function(){return this.tagCode},x.prototype.setTagCode=function(t){this.tagCode=t},A.TagWritten=x;var U=function(t,e){"undefined"!=typeof t?this.tagCode=t:this.tagCode=new Uint8Array(4),"undefined"!=typeof e?this.tagType=e:this.tagType=0};U.prototype=y(k.TagFound),U.isTypeOf=d(k.TagFound),U.prototype.getPayload=function(){var t=new Uint8Array(this.tagCode.length+1);return t[0]=this.tagType,this.tagCode.length>0&&t.set(this.tagCode,1),t},U.prototype.parsePayload=function(t){if(t.length<1)throw new Error("Invalid Payload: tag written response must be longer than one byte");this.tagType=t[0],t.length>1?this.tagCode=t.slice(1):this.tagCode=new Uint8Array(0)},U.prototype.getTagType=function(){return this.tagType},U.prototype.setTagType=function(t){this.tagType=t},U.prototype.getTagCode=function(){return this.tagCode},U.prototype.setTagCode=function(t){this.tagCode=t},A.TagFound=U;var L=function(){};L.prototype=y(k.ScanTimeout),L.isTypeOf=d(k.ScanTimeout),A.ScanTimeout=L;var V=function(){};V.prototype=y(k.EmulationScanSuccess),V.isTypeOf=d(k.EmulationScanSuccess),A.EmulationScanSuccess=V;var O=function(t,e,o){"undefined"!=typeof t?this.tagCode=t:this.tagCode=new Uint8Array(4),"undefined"!=typeof e?this.tagType=e:this.tagType=0,"undefined"!=typeof o?this.message=o:this.message=new Uint8Array(0)};O.prototype=y(k.NdefFound),O.isTypeOf=d(k.NdefFound),O.prototype.getPayload=function(){var t=new Uint8Array(this.tagCode.length+2+this.message.length);return t[0]=this.tagType,t[1]=this.tagCode.length,this.tagCode.length>0&&t.set(this.tagCode,2),this.message.length>0&&t.set(this.message,2+this.tagCode.length),t},O.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid Payload: ndef found response must be longer than one byte");this.tagType=t[0],tagCodeLength=t[1],this.tagCode=t.slice(2,tagCodeLength+2),t.length>tagCodeLength+2?this.message=t.slice(tagCodeLength+2):this.message=new Uint8Array(0)},O.prototype.getTagType=function(){return this.tagType},O.prototype.setTagType=function(t){this.tagType=t},O.prototype.getTagCode=function(){return this.tagCode},O.prototype.setTagCode=function(t){this.tagCode=t},O.prototype.getMessage=function(){return this.message},O.prototype.setMessage=function(t){this.message=t},A.NdefFound=O;var F=function(t,e){"undefined"!=typeof t&&null!==t?this.uid=t:this.uid=new Uint8Array(0),"undefined"!=typeof e&&null!==e?this.tagType=e:this.tagType=0};F.prototype=y(k.TagLocked),F.isTypeOf=d(k.TagLocked),F.prototype.getPayload=function(){var t=new Uint8Array(2+this.uid.length);return t[0]=this.tagType,t[1]=this.uid.length,this.uid.length>0&&t.set(this.uid,2),t},F.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Tag locked responses must be at least 2 bytes");var e=t[1];if(e>0){if(e+2<t.length)throw new Error("Tag locked response too short to contain tag code of specified length");this.uid=t.subarray(2,2+e)}this.tagType=t[0]},F.prototype.setTagType=function(t){this.tagType=t},F.prototype.getTagType=function(){return this.tagType},F.prototype.setTagCode=function(t){this.uid=t},F.prototype.getTagCode=function(){return this.uid},A.TagLocked=F,A.LibraryVersion=function(){arguments.length<2?(this.majorVersion=0,this.minorVersion=0):(this.majorVersion=arguments[0],this.minorVersion=arguments[1])},A.LibraryVersion.prototype=y(k.LibraryVersion),A.LibraryVersion.isTypeOf=d(k.LibraryVersion),A.LibraryVersion.prototype.getPayload=function(){return new Uint8Array([this.majorVersion,this.minorVersion])},A.LibraryVersion.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Firmware version responses must be at least 2 bytes");this.majorVersion=t[0],this.minorVersion=t[1]},A.LibraryVersion.prototype.getMajorVersion=function(){return this.majorVersion},A.LibraryVersion.prototype.getMinorVersion=function(){return this.minorVersion},A.LibraryVersion.prototype.setMajorVersion=function(t){this.majorVersion=t},A.LibraryVersion.prototype.setMinorVersion=function(t){this.minorVersion=t},A.EmulationComplete=function(t,e){"undefined"==typeof t?this.reasonCode=0:this.reasonCode=t,"undefined"==typeof e?this.scanCount=0:this.scanCount=e},A.EmulationComplete.prototype=y(k.EmulationComplete),A.EmulationComplete.isTypeOf=d(k.EmulationComplete),A.EmulationComplete.prototype.getPayload=function(){var t=new Uint8Array(3);return t[0]=this.reasonCode,t[1]=this.scanCount>>8,t[2]=this.scanCount,t},A.EmulationComplete.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Firmware version responses must be at least 2 bytes");this.reasonCode=t[0],this.scanCount=t[1]<<8|t[2]},A.EmulationComplete.prototype.getReasonCode=function(){return this.reasonCode},A.EmulationComplete.prototype.getScanCount=function(){return this.scanCount},A.EmulationComplete.prototype.setReasonCode=function(t){this.reasonCode=t},A.EmulationComplete.prototype.setScanCount=function(t){this.scanCount=t},A.EmulationComplete.ReasonCodes={TIMEOUT:1,MAX_SCANS:2,NEW_COMMAND:3},A.ApplicationError=function(){arguments.length<3?(this.errorCode=0,this.internalErrorCode=0,this.readerStatus=0,this.message=""):(this.errorCode=arguments[0],this.internalErrorCode=arguments[1],this.readerStatus=arguments[2],arguments.length>3?this.message=arguments[3]:this.message="")},A.ApplicationError.isTypeOf=d(k.ApplicationError),A.ApplicationError.prototype=y(k.ApplicationError),A.ApplicationError.prototype.getPayload=function(){for(var t=unescape(encodeURIComponent(this.message)),e=[],o=0;o<t.length;o++)e.push(t.charCodeAt(o));var n=new Uint8Array(3+e.length);return n[0]=this.errorCode,n[1]=this.internalErrorCode,n[2]=this.readerStatus,n.set(e,3),n},A.ApplicationError.prototype.parsePayload=function(t){if(t.length<3)throw new Error("System error payload must be at least 3 bytes");this.errorCode=t[0],this.internalErrorCode=t[1],this.readerStatus=t[2],t.length>3?this.message=String.fromCharCode.apply(null,t.slice(3)):this.message=""},A.ApplicationError.prototype.getErrorCode=function(){return this.errorCode},A.ApplicationError.prototype.getInternalErrorCode=function(){return this.internalErrorCode},A.ApplicationError.prototype.getReaderStatusCode=function(){return this.readerStatus},A.ApplicationError.prototype.getErrorMessage=function(){return this.message},A.ApplicationError.prototype.setErrorCode=function(t){this.errorCode=t},A.ApplicationError.prototype.setInternalErrorCode=function(t){this.internalErrorCode=t},A.ApplicationError.prototype.setReaderStatusCode=function(t){this.readerStatus=t},A.ApplicationError.prototype.setErrorMessage=function(t){this.message=t};var M={INVALID_PARAMETER:1,RFU:2,POLLING_ERROR:3,TOO_FEW_PARAMETERS:4,NDEF_MESSAGE_TOO_LARGE:5,ERROR_CREATING_NDEF_CONTENT:6,ERROR_WRITING_NDEF_CONTENT:7,ERROR_LOCKING_TAG:8},R=function(e){if("object"!=typeof e||null===e)throw new Error("Command passed to resolver must be an object implementing: "+a.join(", "));if(!r(e,a))throw new Error("Error, command passed to resolver must also implement: "+n(e,a).join(", "));return!!i(e.getCommandFamily(),t)},W=function(){};return W.prototype.checkFamily=function(t){return R(t)},W.prototype.validate=function(t){if(R(t))return!0;throw new Error("Resolver doesn't support command's family")},W.prototype.resolveCommand=function(t){var e=null;if(this.validate(t))switch(t.getCommandCode()){case u.WriteNdefUri:e=new s.WriteNdefUri,e.parsePayload(t.getPayload());break;case u.WriteNdefText:e=new s.WriteNdefText,e.parsePayload(t.getPayload());break;case u.WriteNdefCustom:e=new s.WriteNdefCustom,e.parsePayload(t.getPayload());break;case u.StreamTags:e=new s.StreamTags,e.parsePayload(t.getPayload());break;case u.StreamNdef:e=new s.StreamNdef,e.parsePayload(t.getPayload());break;case u.Stop:e=new s.Stop,e.parsePayload(t.getPayload());break;case u.ScanTag:e=new s.ScanTag,e.parsePayload(t.getPayload());break;case u.LockTag:e=new s.LockTag,e.parsePayload(t.getPayload());break;case u.ScanNdef:e=new s.ScanNdef,e.parsePayload(t.getPayload());break;case u.EmulateNdefText:e=new s.EmulateNdefText,e.parsePayload(t.getPayload());break;case u.EmulateNdefUri:e=new s.EmulateNdefUri,e.parsePayload(t.getPayload());break;case u.EmulateNdefCustom:e=new s.EmulateNdefCustom,e.parsePayload(t.getPayload());break;case u.GetLibraryVersion:e=new s.GetLibraryVersion,e.parsePayload(t.getPayload())}return e},W.prototype.resolveResponse=function(t){var e=null;if(this.validate(t)){var o=null;switch(t.getCommandCode()){case k.NdefFound:o=A.NdefFound;break;case k.TagWritten:o=A.TagWritten;break;case k.TagFound:o=A.TagFound;break;case k.ScanTimeout:o=A.ScanTimeout;break;case k.TagLocked:o=A.TagLocked;break;case k.EmulationComplete:o=A.EmulationComplete;break;case k.EmulationScanSuccess:o=A.EmulationScanSuccess;break;case k.LibraryVersion:o=A.LibraryVersion;break;case k.ApplicationError:o=A.ApplicationError}null!==o&&(e=new o,e.parsePayload(t.getPayload()))}return e},{Commands:s,Responses:A,ErrorCodes:M,Resolver:W,FamilyCode:t,PollingModes:p}});