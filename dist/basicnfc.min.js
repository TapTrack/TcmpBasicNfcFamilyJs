!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.TappyBasicNfcFamily=e()}(this,function(){function o(t){var e=Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join("").replace(/(.)/g,function(t,e){var o=e.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o});return decodeURIComponent(e)}function r(t){var e=encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)}),o=new Uint8Array(e.length);return Array.prototype.forEach.call(e,function(t,e){o[e]=t.charCodeAt(0)}),o}function n(t,e){for(var o=[],r=0;r<e.length;r++){var n=e[r];"function"!=typeof t[n]&&o.push(n)}return o}function i(t,e){var o=n(t,e);return!(null===o||0<o.length)}function a(t,o){return t.length==o.length&&t.every(function(t,e){return t===o[e]})}function t(e){return function(t){if("object"!=typeof t||null===t)throw new Error("Command passed to check type must be an object implementing: "+y.join(", "));if(i(t,y))return a(t.getCommandFamily(),h)&&t.getCommandCode()===e;throw new Error("Command passed to check type must also implement: "+n(t,y).join(", "))}}function s(t){return{getCommandFamily:function(){return h},getCommandCode:function(){return t},getPayload:function(){return[]},parsePayload:function(){}}}function e(t){var e=s(t);return e.getPayload=function(){return new Uint8Array([this.timeout,this.pollingMode])},e.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: Basic NFC polling command payload must be at least two bytes");this.timeout=t[0],this.pollingMode=t[1]},e.getTimeout=function(){return this.timeout},e.setTimeout=function(t){this.timeout=t},e.getPollingMode=function(){return this.pollingMode},e.setPollingMode=function(t){this.pollingMode=t},e}function p(){return function(t,e){this.timeout=void 0===t?0:t,this.pollingMode=void 0===e?S.GENERAL:e}}function u(){}var h=new Uint8Array([0,1]),y=["getCommandFamily","getCommandCode","getPayload"],l={},d=5,c=6,g=7,f=9,m=10,C=11,T=1,w=3,E=0,v=2,b=4,P=8,A=255,S={TYPE1:1,GENERAL:2};u.prototype=s(A),u.isTypeOf=t(A),l.GetLibraryVersion=u;var k=p();k.prototype=e(b),k.isTypeOf=t(b),l.ScanNdef=k;var U=p();U.prototype=e(w),U.isTypeOf=t(w),l.StreamNdef=U;var x=p();x.prototype=e(v),x.isTypeOf=t(v),l.ScanTag=x;var N=p();N.prototype=e(T),N.isTypeOf=t(T),l.StreamTags=N;function O(t,e){this.timeout="number"==typeof t?t:0,this.uid=null!=e?e:new Uint8Array(0)}O.prototype=s(P),O.isTypeOf=t(P),O.prototype.getPayload=function(){var t=this.uid.length,e=new Uint8Array(2+t);return e[0]=this.timeout,0<(e[1]=t)&&e.set(this.uid,2),e},O.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: Lock tag command payload must be at least two bytes");this.timeout=t[0];var e=t[1];if(0<e){if(!(e+2<=t.length))throw new Error("Invalid payload: lock tag payload too short to contain UID length claimed");this.uid=t.subarray(2,2+e)}else this.uid=new Uint8Array(0)},O.prototype.getTimeout=function(){return this.timeout},O.prototype.setTimeout=function(t){this.timeout=t},O.prototype.getTagCode=function(){return this.uid},O.prototype.setTagCode=function(t){this.uid=t},l.LockTag=O;function L(){}L.prototype=s(E),L.isTypeOf=t(E),l.Stop=L;function R(t,e,o){this.timeout=void 0===t?0:t,this.locks=void 0!==e&&e,this.text=void 0===o?"":o}R.prototype=s(c),R.isTypeOf=t(c),R.prototype.getPayload=function(){var t=r(this.text),e=new Uint8Array(t.length+2);return e[0]=this.timeout,e[1]=this.locks?1:0,e.set(t,2),e},R.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: write ndef text must be at least 2 bytes long");var e;this.timeout=t[0],this.locks=1===t[1],2<t.length?(e=t.slice(2),this.text=o(e)):this.text=""},R.prototype.getTimeout=function(){return this.timeout},R.prototype.setTimeout=function(t){this.timeout=t},R.prototype.getLockFlag=function(){return this.locks},R.prototype.setLockFlag=function(t){this.locks=t},R.prototype.getText=function(){return this.text},R.prototype.setText=function(t){this.text=t},l.WriteNdefText=R;function M(t,e,o,r){this.timeout=void 0===t?0:t,this.locks=void 0!==e&&e,this.uri=void 0===o?"":o,this.uriCode=void 0===r?0:r}M.prototype=s(d),M.isTypeOf=t(d),M.prototype.getPayload=function(){var t=r(this.uri),e=new Uint8Array(t.length+3);return e[0]=this.timeout,e[1]=this.locks?1:0,e[2]=this.uriCode,e.set(t,3),e},M.prototype.parsePayload=function(t){if(t.length<3)throw new Error("Invalid payload: write ndef uri must be at least 2 bytes long");var e;this.timeout=t[0],this.locks=1===t[1],this.uriCode=t[2],3<t.length?(e=t.slice(3),this.uri=o(e)):this.uri=""},M.prototype.getTimeout=function(){return this.timeout},M.prototype.setTimeout=function(t){this.timeout=t},M.prototype.getLockFlag=function(){return this.locks},M.prototype.setLockFlag=function(t){this.locks=t},M.prototype.getUri=function(){return this.uri},M.prototype.setUri=function(t){this.uri=t},M.prototype.getUriCode=function(){return this.uriCode},M.prototype.setUriCode=function(t){this.uriCode=t},l.WriteNdefUri=M;function V(t,e,o){this.timeout=void 0===t?0:t,this.locks=void 0!==e&&e,this.msg=void 0===o?new Uint8Array(0):o}V.prototype=s(g),V.isTypeOf=t(g),V.prototype.getPayload=function(){var t=new Uint8Array(this.msg.length+2);return t[0]=this.timeout,t[1]=this.locks?1:0,t.set(this.msg,2),t},V.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: write ndef uri must be at least 2 bytes long");this.timeout=t[0],this.locks=1===t[1],2<t.length?this.msg=t.slice(2):this.msg=new Uint8Array(0)},V.prototype.getTimeout=function(){return this.timeout},V.prototype.setTimeout=function(t){this.timeout=t},V.prototype.getLockFlag=function(){return this.locks},V.prototype.setLockFlag=function(t){this.locks=t},V.prototype.getMessage=function(){return this.msg},V.prototype.setMessage=function(t){this.msg=t},l.WriteNdefCustom=V;function F(t,e,o){this.timeout=void 0===t?0:t,this.maxScans=void 0===e?0:e,this.text=void 0===o?"":o}F.prototype=s(f),F.isTypeOf=t(f),F.prototype.getPayload=function(){var t=r(this.text),e=new Uint8Array(t.length+2);return e[0]=this.timeout,e[1]=this.maxScans,e.set(t,2),e},F.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: emulate ndef text must be at least 2 bytes long");var e;this.timeout=t[0],this.maxScans=t[1],2<t.length?(e=t.slice(2),this.text=o(e)):this.text=""},F.prototype.getTimeout=function(){return this.timeout},F.prototype.setTimeout=function(t){this.timeout=t},F.prototype.getMaxScans=function(){return this.maxScans},F.prototype.setMaxScans=function(t){this.maxScans=t},F.prototype.getText=function(){return this.text},F.prototype.setText=function(t){this.text=t},l.EmulateNdefText=F;function I(t,e,o,r){this.timeout=void 0===t?0:t,this.maxScans=void 0===e?0:e,this.uri=void 0===o?"":o,this.uriCode=void 0===r?0:r}I.prototype=s(m),I.isTypeOf=t(m),I.prototype.getPayload=function(){var t=r(this.uri),e=new Uint8Array(t.length+3);return e[0]=this.timeout,e[1]=this.maxScans,e[2]=this.uriCode,e.set(t,3),e},I.prototype.parsePayload=function(t){if(t.length<3)throw new Error("Invalid payload: eumulate ndef uri must be at least 3 bytes long");var e;this.timeout=t[0],this.maxScans=t[1],this.uriCode=t[2],3<t.length?(e=t.slice(3),this.uri=o(e)):this.uri=""},I.prototype.getTimeout=function(){return this.timeout},I.prototype.setTimeout=function(t){this.timeout=t},I.prototype.getMaxScans=function(){return this.maxScans},I.prototype.setMaxScans=function(t){this.maxScans=t},I.prototype.getUriCode=function(){return this.uriCode},I.prototype.setUriCode=function(t){this.uriCode=t},I.prototype.getUri=function(){return this.uri},I.prototype.setUri=function(t){this.uri=t},l.EmulateNdefUri=I;function j(t,e,o){this.timeout=void 0===t?0:t,this.maxScans=void 0===e?0:e,this.msg=void 0===o?new Uint8Array(0):o}j.prototype=s(C),j.isTypeOf=t(C),j.prototype.getPayload=function(){var t=new Uint8Array(2+this.msg.length);return t[0]=this.timeout,t[1]=this.maxScans,t.set(this.msg,2),t},j.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid payload: emulate ndef custom must be at least 2 bytes long");this.timeout=t[0],this.maxScans=t[1],2<t.length?this.msg=t.slice(2):this.msg=new Uint8Array(0)},j.prototype.getTimeout=function(){return this.timeout},j.prototype.setTimeout=function(t){this.timeout=t},j.prototype.getMaxScans=function(){return this.maxScans},j.prototype.setMaxScans=function(t){this.maxScans=t},j.prototype.getMessage=function(){return this.msg},j.prototype.setMessage=function(t){this.msg=t},l.EmulateNdefCustom=j;function _(t,e){this.tagCode=void 0!==t?t:new Uint8Array(4),this.tagType=void 0!==e?e:0}var G={},W=4,D=5,B=1,K=3,X=2,Y=6,q=127,z=7,H=8;_.prototype=s(D),_.isTypeOf=t(D),_.prototype.getPayload=function(){var t=new Uint8Array(this.tagCode.length+1);return t[0]=this.tagType,0<this.tagCode.length&&t.set(this.tagCode,1),t},_.prototype.parsePayload=function(t){if(t.length<1)throw new Error("Invalid Payload: tag written response must be longer than one byte");this.tagType=t[0],1<t.length?this.tagCode=t.slice(1):this.tagCode=new Uint8Array(0)},_.prototype.getTagType=function(){return this.tagType},_.prototype.setTagType=function(t){this.tagType=t},_.prototype.getTagCode=function(){return this.tagCode},_.prototype.setTagCode=function(t){this.tagCode=t},G.TagWritten=_;function J(t,e){this.tagCode=void 0!==t?t:new Uint8Array(4),this.tagType=void 0!==e?e:0}J.prototype=s(B),J.isTypeOf=t(B),J.prototype.getPayload=function(){var t=new Uint8Array(this.tagCode.length+1);return t[0]=this.tagType,0<this.tagCode.length&&t.set(this.tagCode,1),t},J.prototype.parsePayload=function(t){if(t.length<1)throw new Error("Invalid Payload: tag written response must be longer than one byte");this.tagType=t[0],1<t.length?this.tagCode=t.slice(1):this.tagCode=new Uint8Array(0)},J.prototype.getTagType=function(){return this.tagType},J.prototype.setTagType=function(t){this.tagType=t},J.prototype.getTagCode=function(){return this.tagCode},J.prototype.setTagCode=function(t){this.tagCode=t},G.TagFound=J;function Q(){}Q.prototype=s(K),Q.isTypeOf=t(K),G.ScanTimeout=Q;function Z(){}Z.prototype=s(z),Z.isTypeOf=t(z),G.EmulationScanSuccess=Z;function $(t,e,o){this.tagCode=void 0!==t?t:new Uint8Array(4),this.tagType=void 0!==e?e:0,this.message=void 0!==o?o:new Uint8Array(0)}$.prototype=s(X),$.isTypeOf=t(X),$.prototype.getPayload=function(){var t=new Uint8Array(this.tagCode.length+2+this.message.length);return t[0]=this.tagType,t[1]=this.tagCode.length,0<this.tagCode.length&&t.set(this.tagCode,2),0<this.message.length&&t.set(this.message,2+this.tagCode.length),t},$.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Invalid Payload: ndef found response must be longer than one byte");this.tagType=t[0],tagCodeLength=t[1],this.tagCode=t.slice(2,tagCodeLength+2),t.length>tagCodeLength+2?this.message=t.slice(tagCodeLength+2):this.message=new Uint8Array(0)},$.prototype.getTagType=function(){return this.tagType},$.prototype.setTagType=function(t){this.tagType=t},$.prototype.getTagCode=function(){return this.tagCode},$.prototype.setTagCode=function(t){this.tagCode=t},$.prototype.getMessage=function(){return this.message},$.prototype.setMessage=function(t){this.message=t},G.NdefFound=$;function tt(t,e){this.uid=null!=t?t:new Uint8Array(0),this.tagType=null!=e?e:0}tt.prototype=s(Y),tt.isTypeOf=t(Y),tt.prototype.getPayload=function(){var t=new Uint8Array(2+this.uid.length);return t[0]=this.tagType,t[1]=this.uid.length,0<this.uid.length&&t.set(this.uid,2),t},tt.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Tag locked responses must be at least 2 bytes");var e=t[1];if(0<e){if(e+2<t.length)throw new Error("Tag locked response too short to contain tag code of specified length");this.uid=t.subarray(2,2+e)}this.tagType=t[0]},tt.prototype.setTagType=function(t){this.tagType=t},tt.prototype.getTagType=function(){return this.tagType},tt.prototype.setTagCode=function(t){this.uid=t},tt.prototype.getTagCode=function(){return this.uid},G.TagLocked=tt,G.LibraryVersion=function(){arguments.length<2?(this.majorVersion=0,this.minorVersion=0):(this.majorVersion=arguments[0],this.minorVersion=arguments[1])},G.LibraryVersion.prototype=s(W),G.LibraryVersion.isTypeOf=t(W),G.LibraryVersion.prototype.getPayload=function(){return new Uint8Array([this.majorVersion,this.minorVersion])},G.LibraryVersion.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Firmware version responses must be at least 2 bytes");this.majorVersion=t[0],this.minorVersion=t[1]},G.LibraryVersion.prototype.getMajorVersion=function(){return this.majorVersion},G.LibraryVersion.prototype.getMinorVersion=function(){return this.minorVersion},G.LibraryVersion.prototype.setMajorVersion=function(t){this.majorVersion=t},G.LibraryVersion.prototype.setMinorVersion=function(t){this.minorVersion=t},G.EmulationComplete=function(t,e){this.reasonCode=void 0===t?0:t,this.scanCount=void 0===e?0:e},G.EmulationComplete.prototype=s(H),G.EmulationComplete.isTypeOf=t(H),G.EmulationComplete.prototype.getPayload=function(){var t=new Uint8Array(3);return t[0]=this.reasonCode,t[1]=this.scanCount>>8,t[2]=this.scanCount,t},G.EmulationComplete.prototype.parsePayload=function(t){if(t.length<2)throw new Error("Firmware version responses must be at least 2 bytes");this.reasonCode=t[0],this.scanCount=t[1]<<8|t[2]},G.EmulationComplete.prototype.getReasonCode=function(){return this.reasonCode},G.EmulationComplete.prototype.getScanCount=function(){return this.scanCount},G.EmulationComplete.prototype.setReasonCode=function(t){this.reasonCode=t},G.EmulationComplete.prototype.setScanCount=function(t){this.scanCount=t},G.EmulationComplete.ReasonCodes={TIMEOUT:1,MAX_SCANS:2,NEW_COMMAND:3},G.ApplicationError=function(){arguments.length<3?(this.errorCode=0,this.internalErrorCode=0,this.readerStatus=0,this.message=""):(this.errorCode=arguments[0],this.internalErrorCode=arguments[1],this.readerStatus=arguments[2],this.message=3<arguments.length?arguments[3]:"")},G.ApplicationError.isTypeOf=t(q),G.ApplicationError.prototype=s(q),G.ApplicationError.prototype.getPayload=function(){for(var t=unescape(encodeURIComponent(this.message)),e=[],o=0;o<t.length;o++)e.push(t.charCodeAt(o));var r=new Uint8Array(3+e.length);return r[0]=this.errorCode,r[1]=this.internalErrorCode,r[2]=this.readerStatus,r.set(e,3),r},G.ApplicationError.prototype.parsePayload=function(t){if(t.length<3)throw new Error("System error payload must be at least 3 bytes");this.errorCode=t[0],this.internalErrorCode=t[1],this.readerStatus=t[2],3<t.length?this.message=String.fromCharCode.apply(null,t.slice(3)):this.message=""},G.ApplicationError.prototype.getErrorCode=function(){return this.errorCode},G.ApplicationError.prototype.getInternalErrorCode=function(){return this.internalErrorCode},G.ApplicationError.prototype.getReaderStatusCode=function(){return this.readerStatus},G.ApplicationError.prototype.getErrorMessage=function(){return this.message},G.ApplicationError.prototype.setErrorCode=function(t){this.errorCode=t},G.ApplicationError.prototype.setInternalErrorCode=function(t){this.internalErrorCode=t},G.ApplicationError.prototype.setReaderStatusCode=function(t){this.readerStatus=t},G.ApplicationError.prototype.setErrorMessage=function(t){this.message=t};function et(t){if("object"!=typeof t||null===t)throw new Error("Command passed to resolver must be an object implementing: "+y.join(", "));if(!i(t,y))throw new Error("Error, command passed to resolver must also implement: "+n(t,y).join(", "));return!!a(t.getCommandFamily(),h)}function ot(){}return ot.prototype.checkFamily=et,ot.prototype.validate=function(t){if(et(t))return!0;throw new Error("Resolver doesn't support command's family")},ot.prototype.resolveCommand=function(t){var e=null;if(this.validate(t))switch(t.getCommandCode()){case d:(e=new l.WriteNdefUri).parsePayload(t.getPayload());break;case c:(e=new l.WriteNdefText).parsePayload(t.getPayload());break;case g:(e=new l.WriteNdefCustom).parsePayload(t.getPayload());break;case T:(e=new l.StreamTags).parsePayload(t.getPayload());break;case w:(e=new l.StreamNdef).parsePayload(t.getPayload());break;case E:(e=new l.Stop).parsePayload(t.getPayload());break;case v:(e=new l.ScanTag).parsePayload(t.getPayload());break;case P:(e=new l.LockTag).parsePayload(t.getPayload());break;case b:(e=new l.ScanNdef).parsePayload(t.getPayload());break;case f:(e=new l.EmulateNdefText).parsePayload(t.getPayload());break;case m:(e=new l.EmulateNdefUri).parsePayload(t.getPayload());break;case C:(e=new l.EmulateNdefCustom).parsePayload(t.getPayload());break;case A:(e=new l.GetLibraryVersion).parsePayload(t.getPayload())}return e},ot.prototype.resolveResponse=function(t){var e=null;if(this.validate(t)){var o=null;switch(t.getCommandCode()){case X:o=G.NdefFound;break;case D:o=G.TagWritten;break;case B:o=G.TagFound;break;case K:o=G.ScanTimeout;break;case Y:o=G.TagLocked;break;case H:o=G.EmulationComplete;break;case z:o=G.EmulationScanSuccess;break;case W:o=G.LibraryVersion;break;case q:o=G.ApplicationError}null!==o&&(e=new o).parsePayload(t.getPayload())}return e},{Commands:l,Responses:G,ErrorCodes:{INVALID_PARAMETER:1,RFU:2,POLLING_ERROR:3,TOO_FEW_PARAMETERS:4,NDEF_MESSAGE_TOO_LARGE:5,ERROR_CREATING_NDEF_CONTENT:6,ERROR_WRITING_NDEF_CONTENT:7,ERROR_LOCKING_TAG:8},Resolver:ot,FamilyCode:h,PollingModes:S}});